@model CoworkingApp.Models.DataModels.CoworkingCenter
@{
    Layout = "_Layout";
    ViewData["Title"] = "Coworking Center Detail";

    var locationJson = System.Text.Json.JsonSerializer.Serialize(new
    {
        Latitude = Model.Address.Latitude,
        Longitude = Model.Address.Longitude
    });
}
@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const location = JSON.parse('@Html.Raw(locationJson)');
            const coordinates = [location.Latitude, location.Longitude];

            let map = L.map($('#map')[0]).setView(coordinates, 10)

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map)

                L.marker(coordinates).addTo(map).bindPopup(`
                <h2>@Model.Name</h2>
                <p>
                    @Model.Address.StreetAddress<br/>
                    @Model.Address.City.Name, @Model.Address.City.Country.Name<br/>
                    Lat: @Model.Address.Latitude, Lng: @Model.Address.Longitude
                </p>
                `)
        })
    </script>
}


<main id="coworking-center-detail">
    <!-- breadcrumb -->
    <nav aria-label="breadcrumb">
        <a asp-action="Index">go to coworking center listing</a>
    </nav>

    <!-- details panel -->
    <section aria-labelledby="center-details-heading">
        <!-- name -->
        <h1 id="center-name">@Model.Name</h1>

        <!-- description -->
        <p>@Model.Description</p>

        <!-- address -->
        <address>
            @Model.Address.StreetAddress<br/>
            @Model.Address.City.Name, @Model.Address.City.Country.Name<br/>
            Lat: @Model.Address.Latitude, Lng: @Model.Address.Longitude
        </address>
    </section>

    <hr/>

    <!-- map panel -->
    <section aria-labelledby="center-map-heading">
        <h3 id="center-map-heading">Location Map</h3>
        <div id="map" style="height:400px;"></div>
    </section>

    <hr/>

    <!-- related workspaces -->
    <section aria-labelledby="workspaces-heading">
        <h2 id="workspaces-heading">Workspaces</h2>

        @if (Model.Workspaces.Any())
        {
            <ul class="workspace-list">
            @foreach (var ws in Model.Workspaces)
            {
                <li>
                    <article class="workspace-card" aria-labelledby="workspace-@ws.WorkspaceId-name">
                        <h3 id="workspace-@ws.WorkspaceId-name">@ws.Name</h3>
                        <p>@ws.Description</p>
                        <p>
                            Price: @(ws.WorkspacePricings.OrderByDescending(x => x.CreatedBy).First().PricePerHour)&dollar; per hour
                        </p>
                        <menu>
                            <a asp-controller="Workspace" asp-action="Detail" asp-route-id="@ws.WorkspaceId">detail</a>
                            @if (User.Identity != null && User.Identity.IsAuthenticated)
                            {
                                <a asp-controller="Workspace" asp-action="Reserve" asp-route-id="@ws.WorkspaceId">reserve</a>
                            }
                            else
                            {
                                <a asp-controller="Account" asp-action="Login">reserve</a>
                            }
                        </menu>
                    </article>
                </li>
            }
            </ul>
        }
        else
        {
            <p>There are no workspaces in this center :(</p>
        }
    </section>
</main>


@section Styles {
<style>
#coworking-center-detail {
    .workspace-list {
        list-style: none;
        padding: 0;
            
        .workspace-card {
            border: solid gray 1px;
            padding: 0.5rem;
            margin: 0.5rem;
            
            menu {
                margin-top: auto;  /* push to bottom */ 
                display: flex;
                justify-content: flex-end;
                gap: 0.5rem;
            }
        }

        .workspace-card:hover { 
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
    }
}
</style>
}