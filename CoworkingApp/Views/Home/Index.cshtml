@model CoworkingApp.Models.ViewModels.HomeIndexViewModel;

@{
    @* ViewData["Title"] = "DeskSpace"; *@
    
    // send this data to the js side below to add them onto the leaflet map
    var centersData = Model.CoworkingCenters.AsQueryable()
        .Select(c => new {
            c.CoworkingCenterId,
            c.Name,
            c.Description,
            c.Address,
        });

    string centersJson = System.Text.Json.JsonSerializer.Serialize(centersData);
}
@section Scripts {
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const container = document.querySelector('section[aria-labelledby="home-index-map"] > div')
        const map = L.map(container).setView([50.0755, 14.4378], 2)  // prague

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map)

        const centers = @Html.Raw(centersJson)  // deserialize center data from Razor

        centers.forEach(center => {
            L.marker([center.Address.Latitude, center.Address.Longitude]).addTo(map)
                .bindPopup(`
                    <strong><a href='/coworking-center/${center.CoworkingCenterId}'>${center.Name}</a></strong>
                    <br>
                    <p>${center.Description}</p>
                    <a align='right' href='/coworking-center/${center.CoworkingCenterId}'>View detail</a>
                    `)
        })
    })
</script>
}


<main id="home-index">
<section>
    <h2>Welcome to DeskSpace :)</h2>
    <p>
        Discover, explore, and book modern coworking spaces tailored to your needs!
        Whether you're a freelancer, a growing startup, or an enterprise team,
        DeskSpace connects you with inspiring work environments in your city.
    </p>
    <p>
        Get started by browsing our list below or use the map to find the perfect workspace.
        Click on any center for details and availability, and book your spot today!
    </p>
</section>
<section>
    <h2>
        <a id="coworking-center-index-link" asp-controller="CoworkingCenter" asp-action="Index" title="Explore all coworking centers.">
            Our Coworking Centers
        </a>
    </h2>
    <section>
        <ul>
        @foreach (var center in Model.CoworkingCenters.Take(8))
        {
            <li>
                <article>
                    <a asp-controller="CoworkingCenter" asp-action="Detail" asp-route-id="@center.CoworkingCenterId">
                        <h4>@center.Name</h4>
                        <p>@center.Description</p>
                    </a>
                </article>
            </li>
        }
        </ul>
    </section>
    <section aria-labelledby="goto-coworking-centers-index">
        <a asp-controller="CoworkingCenter" asp-action="Index">See all coworking centers</a>
    </section>
    <section aria-labelledby="home-index-map" aria-label="Map of coworking centers">
        <div id="map" style="height: 400px;"></div>
    </section>
</section>
</main>


@section Styles {<style>
#home-index {
    ul {
        list-style: none;
        margin: 1rem;
        padding: 0;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        column-gap: 0.5rem;
        row-gap: 0.5rem;
    }

    ul li {
        margin-block: 0.5rem;
    }

    ul article {
        display: flex;
        flex-direction: column;
        height: 100%;
        border: 1px solid grey;
        padding: 0.5rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);

        h2, h3, h4 {
            color: black;
        }

        p {
            color: black;
        }
    }

    #coworking-center-index-link {
        color: black;
    }

    ul article:hover {
        box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    ul a {
        display: flex;
        flex-direction: column;
        flex: 1;
        text-decoration: none;
    }

    ul h4 {
        margin: 0 0 .5em;
    }

    ul p {
        margin: 0;
        flex-grow: 1;
    }

    section[aria-labelledby="home-index-map"] {
        margin-top: 4rem;
    }

    section[aria-labelledby="goto-coworking-centers-index"] {
        text-align: right;
    }
}
</style>}